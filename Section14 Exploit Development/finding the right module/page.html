<!DOCTYPE html  PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN'  'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'><html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<title>Finding the Right Module</title>
</head><body>when we talk about finding the right module what we're saying is we're looking for a dll or something or something similar inside of a program that has no memory protections.<br/>
<br/>
now there is a tool out there called mona modules that we can use with immunity debugger to achieve this.<br/>
<br/>
(https://github.com/corelan/mona) in this link we need to download mona.py and locate in that location: C:\Program Files (x86)\Immunity Inc\Immunity Debugger\PyCommands and then start vulnserver and immunity.<br/>
<br/>
<br/>
<img src="image.png"/><br/>
<br/>
we wrote that highlighted comamnd and that screen immediately popped up. <br/>
<br/>
these Rebase, SafeSEH, ASLR, NXCompat, OS Dll are protection settings and we want to these as false another thing is that we're looking for something attached to vulnserver which this is the first one. So a prime candidate immediately is this essfunc.dll<br/>
<br/>
before that we want to find hex code equivalent of JMP ESP command. We will do that with nasm_shell.<br/>
<br/>
<img src="image 3.png"/><br/>
<br/>
and now we want to find that command as use FFE4 inside the essfunc.dll file <br/>
<br/>
<img src="image 2.png"/><br/>
<br/>
and we found that outcome and we'll try these<br/>
<br/>
let's write a script for this.<br/>
<br/>
<img src="image 4.png"/><br/>
<br/>
this address wrote in reverse order this is a x86 achitecture's attribute.<br/>
x86 architecture actually stores the low order byte at the lowest address in the higher order byte at the highest address. So in here we're actually trying to fill EIP with that address. To catch this we'll set up a breakpoint for that purpose.<br/>
<br/>
<img src="image 5.png"/><br/>
<br/>
<img src="image 6.png"/><br/>
<br/>
okay then press F2 and this should be blue and now we set up a breakpoint.<br/>
<br/>
now immunity should be able to catch when this address overwrite the EIP. let's execute the script.<br/>
<br/>
<br/>
immediately immunity started to blink.<br/>
<br/>
<img src="image 7.png"/><br/>
actually we could control EIP now we can put a shellcode into ESP and now EIP point that with JMP ESP command.<br/>
<br/>
if we didn't set up a breakpoint this actually will break the program and we cant see whether this address overwrite the EIP or not. <br/>
<br/>
when we did that it actually pause right here for further instructions from us. We don't have anywhere to jump right now we just want to know that we're hitting this address.<br/>
<br/>
</body></html>